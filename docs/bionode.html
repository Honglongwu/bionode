<!DOCTYPE html>

<html>
<head>
  <title>bionode.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>bionode.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>module.exports = exports = bionode = <span class="hljs-keyword">new</span> Bionode()

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Bionode</span><span class="hljs-params">()</span> {</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Create matrices for converting between genetic code bases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> _baseMatrix = { A: <span class="hljs-string">'T'</span>, C: <span class="hljs-string">'G'</span> }

<span class="hljs-keyword">var</span> _dnaComplementBasesMatrix = <span class="hljs-built_in">Object</span>.create(_baseMatrix)
<span class="hljs-keyword">var</span> _rnaComplementBasesMatrix = <span class="hljs-built_in">Object</span>.create(_baseMatrix)
<span class="hljs-keyword">var</span> _transcribeBasesMatrix = <span class="hljs-built_in">Object</span>.create(_baseMatrix)
<span class="hljs-keyword">var</span> _translateCodonsMatrix = {
  <span class="hljs-string">'GCU'</span>: <span class="hljs-string">'A'</span>, <span class="hljs-string">'GCC'</span>: <span class="hljs-string">'A'</span>, <span class="hljs-string">'GCA'</span>: <span class="hljs-string">'A'</span>, <span class="hljs-string">'GCG'</span>: <span class="hljs-string">'A'</span>, <span class="hljs-string">'CGU'</span>: <span class="hljs-string">'R'</span>, <span class="hljs-string">'CGC'</span>: <span class="hljs-string">'R'</span>,
  <span class="hljs-string">'CGA'</span>: <span class="hljs-string">'R'</span>, <span class="hljs-string">'CGG'</span>: <span class="hljs-string">'R'</span>, <span class="hljs-string">'AGA'</span>: <span class="hljs-string">'R'</span>, <span class="hljs-string">'AGG'</span>: <span class="hljs-string">'R'</span>, <span class="hljs-string">'AAU'</span>: <span class="hljs-string">'N'</span>, <span class="hljs-string">'AAC'</span>: <span class="hljs-string">'N'</span>,
  <span class="hljs-string">'GAU'</span>: <span class="hljs-string">'D'</span>, <span class="hljs-string">'GAC'</span>: <span class="hljs-string">'D'</span>, <span class="hljs-string">'UGU'</span>: <span class="hljs-string">'C'</span>, <span class="hljs-string">'UGC'</span>: <span class="hljs-string">'C'</span>, <span class="hljs-string">'CAA'</span>: <span class="hljs-string">'Q'</span>, <span class="hljs-string">'CAG'</span>: <span class="hljs-string">'Q'</span>,
  <span class="hljs-string">'GAA'</span>: <span class="hljs-string">'E'</span>, <span class="hljs-string">'GAG'</span>: <span class="hljs-string">'E'</span>, <span class="hljs-string">'GGU'</span>: <span class="hljs-string">'G'</span>, <span class="hljs-string">'GGC'</span>: <span class="hljs-string">'G'</span>, <span class="hljs-string">'GGA'</span>: <span class="hljs-string">'G'</span>, <span class="hljs-string">'GGG'</span>: <span class="hljs-string">'G'</span>,
  <span class="hljs-string">'CAU'</span>: <span class="hljs-string">'H'</span>, <span class="hljs-string">'CAC'</span>: <span class="hljs-string">'H'</span>, <span class="hljs-string">'AUU'</span>: <span class="hljs-string">'I'</span>, <span class="hljs-string">'AUC'</span>: <span class="hljs-string">'I'</span>, <span class="hljs-string">'AUA'</span>: <span class="hljs-string">'I'</span>, <span class="hljs-string">'UUA'</span>: <span class="hljs-string">'L'</span>,
  <span class="hljs-string">'UUG'</span>: <span class="hljs-string">'L'</span>, <span class="hljs-string">'CUU'</span>: <span class="hljs-string">'L'</span>, <span class="hljs-string">'CUC'</span>: <span class="hljs-string">'L'</span>, <span class="hljs-string">'CUA'</span>: <span class="hljs-string">'L'</span>, <span class="hljs-string">'CUG'</span>: <span class="hljs-string">'L'</span>, <span class="hljs-string">'AAA'</span>: <span class="hljs-string">'K'</span>,
  <span class="hljs-string">'AAG'</span>: <span class="hljs-string">'K'</span>, <span class="hljs-string">'AUG'</span>: <span class="hljs-string">'M'</span>, <span class="hljs-string">'UUU'</span>: <span class="hljs-string">'F'</span>, <span class="hljs-string">'UUC'</span>: <span class="hljs-string">'F'</span>, <span class="hljs-string">'CCU'</span>: <span class="hljs-string">'P'</span>, <span class="hljs-string">'CCC'</span>: <span class="hljs-string">'P'</span>,
  <span class="hljs-string">'CCA'</span>: <span class="hljs-string">'P'</span>, <span class="hljs-string">'CCG'</span>: <span class="hljs-string">'P'</span>, <span class="hljs-string">'UCU'</span>: <span class="hljs-string">'S'</span>, <span class="hljs-string">'UCC'</span>: <span class="hljs-string">'S'</span>, <span class="hljs-string">'UCA'</span>: <span class="hljs-string">'S'</span>, <span class="hljs-string">'UCG'</span>: <span class="hljs-string">'S'</span>,
  <span class="hljs-string">'AGU'</span>: <span class="hljs-string">'S'</span>, <span class="hljs-string">'AGC'</span>: <span class="hljs-string">'S'</span>, <span class="hljs-string">'ACU'</span>: <span class="hljs-string">'T'</span>, <span class="hljs-string">'ACC'</span>: <span class="hljs-string">'T'</span>, <span class="hljs-string">'ACA'</span>: <span class="hljs-string">'T'</span>, <span class="hljs-string">'ACG'</span>: <span class="hljs-string">'T'</span>,
  <span class="hljs-string">'UGG'</span>: <span class="hljs-string">'W'</span>, <span class="hljs-string">'UAU'</span>: <span class="hljs-string">'Y'</span>, <span class="hljs-string">'UAC'</span>: <span class="hljs-string">'Y'</span>, <span class="hljs-string">'GUU'</span>: <span class="hljs-string">'V'</span>, <span class="hljs-string">'GUC'</span>: <span class="hljs-string">'V'</span>, <span class="hljs-string">'GUA'</span>: <span class="hljs-string">'V'</span>,
  <span class="hljs-string">'GUG'</span>: <span class="hljs-string">'V'</span>, <span class="hljs-string">'UAA'</span>: <span class="hljs-string">'*'</span>, <span class="hljs-string">'UGA'</span>: <span class="hljs-string">'*'</span>, <span class="hljs-string">'UAG'</span>: <span class="hljs-string">'*'</span>, <span class="hljs-string">'gcu'</span>: <span class="hljs-string">'a'</span>, <span class="hljs-string">'gcc'</span>: <span class="hljs-string">'a'</span>,
  <span class="hljs-string">'gca'</span>: <span class="hljs-string">'a'</span>, <span class="hljs-string">'gcg'</span>: <span class="hljs-string">'a'</span>, <span class="hljs-string">'cgu'</span>: <span class="hljs-string">'r'</span>, <span class="hljs-string">'cgc'</span>: <span class="hljs-string">'r'</span>, <span class="hljs-string">'cga'</span>: <span class="hljs-string">'r'</span>, <span class="hljs-string">'cgg'</span>: <span class="hljs-string">'r'</span>,
  <span class="hljs-string">'aga'</span>: <span class="hljs-string">'r'</span>, <span class="hljs-string">'agg'</span>: <span class="hljs-string">'r'</span>, <span class="hljs-string">'aau'</span>: <span class="hljs-string">'n'</span>, <span class="hljs-string">'aac'</span>: <span class="hljs-string">'n'</span>, <span class="hljs-string">'gau'</span>: <span class="hljs-string">'d'</span>, <span class="hljs-string">'gac'</span>: <span class="hljs-string">'d'</span>,
  <span class="hljs-string">'ugu'</span>: <span class="hljs-string">'c'</span>, <span class="hljs-string">'ugc'</span>: <span class="hljs-string">'c'</span>, <span class="hljs-string">'caa'</span>: <span class="hljs-string">'q'</span>, <span class="hljs-string">'cag'</span>: <span class="hljs-string">'q'</span>, <span class="hljs-string">'gaa'</span>: <span class="hljs-string">'e'</span>, <span class="hljs-string">'gag'</span>: <span class="hljs-string">'e'</span>,
  <span class="hljs-string">'ggu'</span>: <span class="hljs-string">'g'</span>, <span class="hljs-string">'ggc'</span>: <span class="hljs-string">'g'</span>, <span class="hljs-string">'gga'</span>: <span class="hljs-string">'g'</span>, <span class="hljs-string">'ggg'</span>: <span class="hljs-string">'g'</span>, <span class="hljs-string">'cau'</span>: <span class="hljs-string">'h'</span>, <span class="hljs-string">'cac'</span>: <span class="hljs-string">'h'</span>,
  <span class="hljs-string">'auu'</span>: <span class="hljs-string">'i'</span>, <span class="hljs-string">'auc'</span>: <span class="hljs-string">'i'</span>, <span class="hljs-string">'aua'</span>: <span class="hljs-string">'i'</span>, <span class="hljs-string">'uua'</span>: <span class="hljs-string">'l'</span>, <span class="hljs-string">'uug'</span>: <span class="hljs-string">'l'</span>, <span class="hljs-string">'cuu'</span>: <span class="hljs-string">'l'</span>,
  <span class="hljs-string">'cuc'</span>: <span class="hljs-string">'l'</span>, <span class="hljs-string">'cua'</span>: <span class="hljs-string">'l'</span>, <span class="hljs-string">'cug'</span>: <span class="hljs-string">'l'</span>, <span class="hljs-string">'aaa'</span>: <span class="hljs-string">'k'</span>, <span class="hljs-string">'aag'</span>: <span class="hljs-string">'k'</span>, <span class="hljs-string">'aug'</span>: <span class="hljs-string">'m'</span>,
  <span class="hljs-string">'uuu'</span>: <span class="hljs-string">'f'</span>, <span class="hljs-string">'uuc'</span>: <span class="hljs-string">'f'</span>, <span class="hljs-string">'ccu'</span>: <span class="hljs-string">'p'</span>, <span class="hljs-string">'ccc'</span>: <span class="hljs-string">'p'</span>, <span class="hljs-string">'cca'</span>: <span class="hljs-string">'p'</span>, <span class="hljs-string">'ccg'</span>: <span class="hljs-string">'p'</span>,
  <span class="hljs-string">'ucu'</span>: <span class="hljs-string">'s'</span>, <span class="hljs-string">'ucc'</span>: <span class="hljs-string">'s'</span>, <span class="hljs-string">'uca'</span>: <span class="hljs-string">'s'</span>, <span class="hljs-string">'ucg'</span>: <span class="hljs-string">'s'</span>, <span class="hljs-string">'agu'</span>: <span class="hljs-string">'s'</span>, <span class="hljs-string">'agc'</span>: <span class="hljs-string">'s'</span>,
  <span class="hljs-string">'acu'</span>: <span class="hljs-string">'t'</span>, <span class="hljs-string">'acc'</span>: <span class="hljs-string">'t'</span>, <span class="hljs-string">'aca'</span>: <span class="hljs-string">'t'</span>, <span class="hljs-string">'acg'</span>: <span class="hljs-string">'t'</span>, <span class="hljs-string">'ugg'</span>: <span class="hljs-string">'w'</span>, <span class="hljs-string">'uau'</span>: <span class="hljs-string">'y'</span>,
  <span class="hljs-string">'uac'</span>: <span class="hljs-string">'y'</span>, <span class="hljs-string">'guu'</span>: <span class="hljs-string">'v'</span>, <span class="hljs-string">'guc'</span>: <span class="hljs-string">'v'</span>, <span class="hljs-string">'gua'</span>: <span class="hljs-string">'v'</span>, <span class="hljs-string">'gug'</span>: <span class="hljs-string">'v'</span>, <span class="hljs-string">'uaa'</span>: <span class="hljs-string">'*'</span>,
  <span class="hljs-string">'uga'</span>: <span class="hljs-string">'*'</span>, <span class="hljs-string">'uag'</span>: <span class="hljs-string">'*'</span>
}

_rnaComplementBasesMatrix[<span class="hljs-string">'A'</span>] = <span class="hljs-string">'U'</span>
<span class="hljs-keyword">delete</span> _rnaComplementBasesMatrix[<span class="hljs-string">'T'</span>]

_transcribeBasesMatrix[<span class="hljs-string">'A'</span>] = <span class="hljs-string">'U'</span>

mirrorAndLowerCaseMatrices([
  _dnaComplementBasesMatrix,
  _rnaComplementBasesMatrix,
  _transcribeBasesMatrix
])

_transcribeBasesMatrix[<span class="hljs-string">'T'</span>] = <span class="hljs-string">'A'</span>
_transcribeBasesMatrix[<span class="hljs-string">'t'</span>] = <span class="hljs-string">'a'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Helper function to mirror bases for translation (e.g. A&lt;-&gt;T) and also add lowerCases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mirrorAndLowerCaseMatrices</span><span class="hljs-params">(matricesArray)</span> {</span>
  matricesArray.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(matrix)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> matrix) {
      <span class="hljs-keyword">var</span> v = matrix[k]
      matrix[k.toLowerCase()] = v.toLowerCase()
      matrix[v] = k
      matrix[v.toLowerCase()] = k.toLowerCase()
    }
  })
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Takes a sequence and quickly checks if it’s dna or rna. Doesn’t check for mixing errors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.checkSequenceType = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">var</span> sequenceTypes = {
    t: <span class="hljs-string">'dna'</span>,
    T: <span class="hljs-string">'dna'</span>,
    u: <span class="hljs-string">'rna'</span>,
    U: <span class="hljs-string">'rna'</span>
  }
  <span class="hljs-keyword">var</span> matchBase = sequence.match(<span class="hljs-regexp">/t|T|u|U/</span>)[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">var</span> sequenceType = sequenceTypes[matchBase]
  <span class="hljs-keyword">return</span> sequenceType
}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Takes a sequence type argument and returns a function to complement bases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.createComplementBase = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequenceType)</span> {</span>
  <span class="hljs-keyword">var</span> complementBasesMatrix = sequenceType === <span class="hljs-string">'rna'</span> ? _rnaComplementBasesMatrix : _dnaComplementBasesMatrix
  <span class="hljs-keyword">var</span> getComplementBase = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(base)</span> {</span>
    <span class="hljs-keyword">var</span> complement = complementBasesMatrix[base]
    <span class="hljs-keyword">return</span> complement || base
  }
  <span class="hljs-keyword">return</span> getComplementBase
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Takes sequence string and returns the reverse sequence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.reverse = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">return</span> sequence.split(<span class="hljs-string">''</span>).reverse().join(<span class="hljs-string">''</span>)
}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Takes a sequence string and optional boolean for reverse, and returns it’s complement.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.complement = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence, reverse)</span> {</span>
  <span class="hljs-keyword">var</span> reverse = reverse || <span class="hljs-literal">false</span>
  <span class="hljs-keyword">var</span> sequenceType = bionode.checkSequenceType(sequence)
  <span class="hljs-keyword">var</span> getComplementBase = bionode.createComplementBase(sequenceType)
  <span class="hljs-keyword">if</span> (reverse) {
    <span class="hljs-keyword">return</span> sequence.split(<span class="hljs-string">''</span>).reverse().map(getComplementBase).join(<span class="hljs-string">''</span>)
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> sequence.split(<span class="hljs-string">''</span>).map(getComplementBase).join(<span class="hljs-string">''</span>)
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Takes a sequence string and returns the reverse complement (syntax sugar).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.reverseComplement = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">return</span> bionode.complement(sequence, <span class="hljs-literal">true</span>)
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Takes a base character and returns the transcript base.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.getTranscribedBase = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(base)</span> {</span>
  <span class="hljs-keyword">return</span> _transcribeBasesMatrix[base] || base
}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Takes an RNA codon and returns the translated amino acid.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.getTranslatedAA = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(codon)</span> {</span>
  <span class="hljs-keyword">return</span> _translateCodonsMatrix[codon]
}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Take a sequence and an array of exonsRanges and removes them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.removeIntrons = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence, exonsRanges)</span> {</span>
  <span class="hljs-keyword">var</span> sequenceWithoutIntrons = <span class="hljs-string">''</span>
  <span class="hljs-keyword">var</span> exonsRangesSorted = exonsRanges.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> {</span> <span class="hljs-keyword">return</span> a[<span class="hljs-number">0</span>] - b[<span class="hljs-number">0</span>] })
  exonsRangesSorted.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(exonRange)</span> {</span>
    sequenceWithoutIntrons += sequence.substring(exonRange[<span class="hljs-number">0</span>], exonRange[<span class="hljs-number">1</span>])
  })
  <span class="hljs-keyword">return</span> sequenceWithoutIntrons
}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Takes a sequence string and returns the transcribed sequence (dna &lt;-&gt; rna).
If an array of exons is given, the introns will be removed from the sequence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.transcribe = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence, exonsRanges)</span> {</span>
  <span class="hljs-keyword">if</span> (exonsRanges) {
    <span class="hljs-keyword">var</span> sequenceWithoutIntrons = bionode.removeIntrons(sequence, exonsRanges)
    sequence = sequenceWithoutIntrons
  }
  <span class="hljs-keyword">var</span> sequenceType = bionode.checkSequenceType(sequence)
  <span class="hljs-keyword">if</span> (sequenceType === <span class="hljs-string">'dna'</span>) {
    <span class="hljs-keyword">return</span> sequence.replace(<span class="hljs-regexp">/t/g</span>, <span class="hljs-string">'u'</span>).replace(<span class="hljs-regexp">/T/g</span>, <span class="hljs-string">'U'</span>)
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sequenceType === <span class="hljs-string">'rna'</span>) {
    <span class="hljs-keyword">return</span> sequence.replace(<span class="hljs-regexp">/u/g</span>, <span class="hljs-string">'t'</span>).replace(<span class="hljs-regexp">/U/g</span>, <span class="hljs-string">'T'</span>)
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Takes a DNA or RNA sequence and translates it to protein
If an array of exons is given, the introns will be removed from the sequence.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.translate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence, exonsRanges)</span> {</span>
  <span class="hljs-keyword">if</span> (exonsRanges) {
    <span class="hljs-keyword">var</span> sequenceWithoutIntrons = bionode.removeIntrons(sequence, exonsRanges)
    sequence = sequenceWithoutIntrons
  }
  <span class="hljs-keyword">var</span> sequenceType = bionode.checkSequenceType(sequence)
  <span class="hljs-keyword">var</span> rna
  <span class="hljs-keyword">if</span> (sequenceType === <span class="hljs-string">'dna'</span>) {
    rna = bionode.transcribe(sequence, exonsRanges)
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sequenceType === <span class="hljs-string">'rna'</span>) {
    rna = sequence
  }
  <span class="hljs-keyword">return</span> rna.match(<span class="hljs-regexp">/.{1,3}/g</span>).map(bionode.getTranslatedAA).join(<span class="hljs-string">''</span>)
}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Takes an array of exons and the length of the reference and returns inverted coordinates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.reverseExons = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(exonsRanges, referenceLength)</span> {</span>
  <span class="hljs-keyword">var</span> reversedExonsRanges = []
  exonsRanges.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(exonRange)</span> {</span>
    <span class="hljs-keyword">var</span> start = referenceLength - exonRange[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">var</span> stop = referenceLength - exonRange[<span class="hljs-number">0</span>]
    reversedExonsRanges.push([start, stop])
  })
  <span class="hljs-keyword">return</span> reversedExonsRanges
}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Takes a sequence and exons ranges and returns an array of non canonical splice sites.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.findNonCanonicalSplices = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence, exonsRanges)</span> {</span>
  <span class="hljs-keyword">var</span> nonCanonicalSplices = []
  <span class="hljs-keyword">var</span> exonsRangesSorted = exonsRanges.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> {</span> <span class="hljs-keyword">return</span> a[<span class="hljs-number">0</span>] - b[<span class="hljs-number">0</span>] })
  exonsRangesSorted.forEach(checkNonCanonicalIntron)
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkNonCanonicalIntron</span><span class="hljs-params">(exonRange, i)</span> {</span>
    <span class="hljs-keyword">var</span> donor = exonRange
    <span class="hljs-keyword">var</span> acceptor = exonsRangesSorted[i + <span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> (!acceptor) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">var</span> intronRange = [donor[<span class="hljs-number">1</span>], acceptor[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">var</span> intronStartBases = sequence.slice(intronRange[<span class="hljs-number">0</span>], intronRange[<span class="hljs-number">0</span>] + <span class="hljs-number">2</span>).toLowerCase().replace(<span class="hljs-string">'t'</span>, <span class="hljs-string">'u'</span>)
    <span class="hljs-keyword">var</span> intronStopBases = sequence.slice(intronRange[<span class="hljs-number">1</span>] - <span class="hljs-number">2</span>, intronRange[<span class="hljs-number">1</span>]).toLowerCase()
    <span class="hljs-keyword">if</span> (intronStartBases !== <span class="hljs-string">'gu'</span>)
      nonCanonicalSplices.push(intronRange[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">if</span> (intronStopBases !== <span class="hljs-string">'ag'</span>)
      nonCanonicalSplices.push(intronRange[<span class="hljs-number">1</span>])
  }
  <span class="hljs-keyword">return</span> nonCanonicalSplices
}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Takes a sequence and returns boolean for canonical translation start site.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.checkCanonicalTranslationStartSite = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">return</span> sequence.substring(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>).toLowerCase().replace(<span class="hljs-string">'t'</span>, <span class="hljs-string">'u'</span>) === <span class="hljs-string">'aug'</span>
}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Takes a sequence and returns an array with the six possible Reading Frames (+1, +2, +3, -1, -2, -3).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.getReadingFrames = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">var</span> reverse = bionode.reverseComplement(sequence)
  <span class="hljs-keyword">return</span> [sequence, sequence.substring(<span class="hljs-number">1</span>), sequence.substring(<span class="hljs-number">2</span>), reverse, reverse.substring(<span class="hljs-number">1</span>), reverse.substring(<span class="hljs-number">2</span>)]
}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Takes a Reading Frame sequence and returns an array of Open Reading Frames.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.getOpenReadingFrames = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">var</span> sequenceType = bionode.checkSequenceType(sequence)
  <span class="hljs-keyword">var</span> stopCodons
  <span class="hljs-keyword">if</span> (sequenceType === <span class="hljs-string">'dna'</span>) {
    stopCodons = [<span class="hljs-string">'TAA'</span>, <span class="hljs-string">'TGA'</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'taa'</span>, <span class="hljs-string">'tga'</span>, <span class="hljs-string">'tag'</span>]
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sequenceType === <span class="hljs-string">'rna'</span>) {
    stopCodons = [<span class="hljs-string">'UAA'</span>, <span class="hljs-string">'UGA'</span>, <span class="hljs-string">'UAG'</span>, <span class="hljs-string">'uaa'</span>, <span class="hljs-string">'uga'</span>, <span class="hljs-string">'uag'</span>]
  }
  <span class="hljs-keyword">var</span> openReadingFrames = []
  <span class="hljs-keyword">var</span> openReadingFrame = <span class="hljs-string">''</span>
  sequence.match(<span class="hljs-regexp">/.{1,3}/g</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(codon)</span> {</span>
    openReadingFrame += codon
    <span class="hljs-keyword">if</span> (stopCodons.indexOf(codon) !== -<span class="hljs-number">1</span> &amp;&amp; openReadingFrame.length &gt; <span class="hljs-number">0</span>) {
      openReadingFrames.push(openReadingFrame)
      openReadingFrame = <span class="hljs-string">''</span>
    }
  })
  openReadingFrames.push(openReadingFrame)
  <span class="hljs-keyword">return</span> openReadingFrames
}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Takes a sequence and returns all Open Reading Frames in the six Reading Frames.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.getAllOpenReadingFrames = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">var</span> readingFrames = bionode.getReadingFrames(sequence)
  <span class="hljs-keyword">var</span> allOpenReadingFrames = readingFrames.map(bionode.getOpenReadingFrames)
  <span class="hljs-keyword">return</span> allOpenReadingFrames
}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Takes a sequence and returns the longest ORF
If there’s a tie, choose the one that starts with Methionine
If there’s still a tie, return one randomly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Bionode.prototype.findLongestOpenReadingFrame = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sequence)</span> {</span>
  <span class="hljs-keyword">var</span> longestOpenReadingFrame = bionode.getAllOpenReadingFrames(sequence)
  .map(getLongest)
  .sort(sortReadingFrame)[<span class="hljs-number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Helper that sorts by length, giving priority to ones that start with ATG/AUG</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortReadingFrame</span><span class="hljs-params">(a, b)</span> {</span>
    <span class="hljs-keyword">var</span> aSort = a.length
    <span class="hljs-keyword">var</span> bSort = b.length
    <span class="hljs-keyword">if</span> (bSort - aSort === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">var</span> aStartCodon = a.slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>).toUpperCase().replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">'U'</span>)
      <span class="hljs-keyword">var</span> bStartCodon = b.slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>).toUpperCase().replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">'U'</span>)
      <span class="hljs-keyword">if</span> (aStartCodon === <span class="hljs-string">'AUG'</span>) { aSort++ }
      <span class="hljs-keyword">if</span> (bStartCodon === <span class="hljs-string">'AUG'</span>) { bSort++ }
    }
    <span class="hljs-keyword">return</span> bSort - aSort
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Helper that takes an array and returns longest Reading Frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLongest</span><span class="hljs-params">(array)</span> {</span>
    <span class="hljs-keyword">return</span> array.sort(sortReadingFrame)[<span class="hljs-number">0</span>]
  }

  <span class="hljs-keyword">return</span> longestOpenReadingFrame
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
